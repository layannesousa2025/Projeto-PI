<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Eventos de eSports Perto de Voc√™</title>
  <link rel="stylesheet" href="Css/categoria.css">
  
</head>
<body>
  <header>
    <h1>"Categorias de eSports"</h1>
    <p>Use sua localiza√ß√£o para ver Eventos mais perto de voc√™!!!</p>
  </header>

  <div class="wrap">
    <section class="controls" aria-label="Filtros de busca">
      <div class="field">
        <label class="label" for="q">Pesquisar (nome/cidade)</label>
        <input id="q" type="text" placeholder="Eventos em Brasilia-DF..." />
      </div>



      <div class="field">
        <label class="label" for="game">Eventos</label>
        <select id="game">
          <option value="">Todos</option>
          <option>Academia</option>
          <option>Ciclimos</option>
          <option>Caminhada</option>
          <option>Nata√ß√£o</option>
          <option>Voleibol</option>
          <option>Lazer</option>
        </select>
      </div>

      <div class="field">
        <label class="label" for="from">Data de</label>
        <input id="from" type="date"/>
      </div>

      <div class="field">
        <label class="label" for="to">at√©</label>
        <input id="to" type="date"/>
      </div>

      <div class="row-span inline">
        <button id="useLoc" class="btn primary" type="button">üìç Usar minha localiza√ß√£o</button>
        <button id="clearFilters" class="btn ghost" type="button">Limpar filtros</button>
      </div>

      <div class="row-span">
        <div class="field">
          <label class="label" for="radius">Raio de busca: <span id="radiusLabel">50</span> km</label>
          <input id="radius" type="range" min="5" max="500" step="5" value="50" />
        </div>
      </div>

      <div class="row-span">
        <div class="inline">
          <div class="field" style="min-width: 180px;">
            <label class="label" for="sort">Ordenar por</label>
            <select id="sort">
              <option value="distance">Proximidade</option>
              <option value="date">Data</option>
            </select>
          </div>
        </div>
      </div>

      

      <details class="helper row-span">
        <summary>N√£o conseguiu usar o GPS? Ajuste sua localiza√ß√£o manualmente</summary>
        <div class="inline" style="margin-top:8px">
          <div class="field">
            <label class="label" for="lat">Latitude</label>
            <input id="lat" type="number" step="0.000001" placeholder="Ex.: -23.550520" />
          </div>
          <div class="field">
            <label class="label" for="lon">Longitude</label>
            <input id="lon" type="number" step="0.000001" placeholder="Ex.: -46.633308" />
          </div>
          <button id="applyManual" class="btn" type="button">Aplicar</button>
        </div>
      </details>
    </section>

    <div class="meta">
      <div><span id="count">0</span> eventos encontrados</div>
      <div id="locHint" class="muted">Dica: ative sua localiza√ß√£o para ver dist√¢ncias</div>
    </div>

    <section id="results" class="grid" aria-live="polite"></section>

    <div id="empty" class="empty" style="display:none;">Nenhum evento encontrado. Ajuste os filtros ou aumente o raio.</div>
  </div>



  <script>
    // --- Dados de exemplo (substitua por sua API) ---
    const events = [
      { id: 1, title: "Caminhada", lugar: "MovimentBrasilia", cidade: "Bras√≠lia/DF", venue: "evento DF", date: "2025-09-20", lat: -70730-511, lon: -46.633308 },
      { id: 2, title: "Academia", lugar: "SmatFlit", cidade: "Brasilia/DF", venue: "evento DF", date: "2025-09-20", lat: -70297-400, lon: -46.633308 },
      { id: 3, title: "Ciclimismo", lugar: "BRAS√çLIA BIKE CAMP ", cidade: "Brasilia/DF", venue: " SIT Torre de TV Digital de Bras√≠lia", date: "2025-09-13", lat: -70297-400, lon: -43.172897 },
      { id: 4, title: "Natacao", lugar: "Manta - nata√ß√£o 610 sul", cidade: "Brasilia/DF", venue: " Dentro do Sindilegis - 610, lote 70", date: "2025-09-27", lat: -70200-700, lon: -43.934493 },
      { id: 5, title: "Voleibol", lugar: "Bras√≠lia V√¥lei Esporte Clube", cidade: "Brasilia/DF", venue: "St. F Norte - Taguatinga, Bras√≠lia ", date: "2025-09-21", lat: -72135-120, lon: -34.877001 },
      { id: 6, title: "Lazer", lugar: "#", cidade: "#", venue: "#", date: "2025-09-30", lat: -22.909938, lon: -47.062633 }
    ];

    // --- Estado ---
    let userLoc = null; // {lat, lon}

    // --- Utilidades ---
    const $ = sel => document.querySelector(sel);
    const km = n => `${n.toFixed(1)} km`;

    function toDate(s) { const d = new Date(s + 'T00:00:00'); d.setHours(12); return d; }

    // Haversine
    function distKm(a, b) {
      if (!a || !b) return Infinity;
      const R = 6371;
      const dLat = (b.lat - a.lat) * Math.PI / 180;
      const dLon = (b.lon - a.lon) * Math.PI / 180;
      const s1 = Math.sin(dLat/2) ** 2 + Math.cos(a.lat * Math.PI/180) * Math.cos(b.lat * Math.PI/180) * Math.sin(dLon/2) ** 2;
      return 2 * R * Math.asin(Math.sqrt(s1));
    }

    function withinRadius(ev, radiusKm) {
      if (!userLoc) return true; // se n√£o h√° localiza√ß√£o, n√£o filtra por raio
      return distKm(userLoc, {lat: ev.lat, lon: ev.lon}) <= radiusKm;
    }

    function render() {
      const q = $('#q').value.trim().toLowerCase();
      const game = $('#game').value;
      const from = $('#from').value ? toDate($('#from').value) : null;
      const to = $('#to').value ? toDate($('#to').value) : null;
      const radius = +$('#radius').value;
      const sort = $('#sort').value;

      const filtered = events
        .filter(ev => !q || `${ev.title} ${ev.city} ${ev.game}`.toLowerCase().includes(q))
        .filter(ev => !game || ev.game === game)
        .filter(ev => !from || toDate(ev.date) >= from)
        .filter(ev => !to || toDate(ev.date) <= to)
        .filter(ev => withinRadius(ev, radius))
        .map(ev => ({
          ...ev,
          distance: userLoc ? distKm(userLoc, {lat: ev.lat, lon: ev.lon}) : null
        }));

      filtered.sort((a, b) => {
        if (sort === 'date') return toDate(a.date) - toDate(b.date);
        // default: distance
        const da = a.distance ?? Infinity, db = b.distance ?? Infinity;
        if (da === db) return toDate(a.date) - toDate(b.date);
        return da - db;
      });

      $('#count').textContent = filtered.length;
      $('#empty').style.display = filtered.length ? 'none' : 'block';

      const res = $('#results');
      res.innerHTML = '';

      for (const ev of filtered) {
        const card = document.createElement('article');
        card.className = 'card';
        card.innerHTML = `
          <div class="inline" style="justify-content:space-between; align-items:center;">
            <span class="tag">${ev.game}</span>
            ${ev.distance != null ? `<span class="muted">üìç ${km(ev.distance)}</span>` : ''}
          </div>
          <div class="title">${ev.title}</div>
          <div class="muted">üóìÔ∏è ${new Date(ev.date).toLocaleDateString('pt-BR')} ¬∑ üìå ${ev.venue} ¬∑ ${ev.city}</div>
          <div class="inline">
            <a class="btn" href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(ev.venue + ' ' + ev.city)}" target="_blank" rel="noopener">Ver no mapa</a>
            <a class="btn" href="#" onclick="alert('Conecte a p√°gina do evento aqui.'); return false;">Detalhes</a>
          </div>
        `;
        res.appendChild(card);
      }

      // Dica de localiza√ß√£o
      $('#locHint').textContent = userLoc 
        ? `Sua localiza√ß√£o est√° ativa. Raio: ${radius} km.`
        : 'Dica: ative sua localiza√ß√£o para ver dist√¢ncias';
      $('#radiusLabel').textContent = radius;
    }

    // --- Eventos UI ---
    ['q','game','from','to','radius','sort'].forEach(id => {
      document.getElementById(id).addEventListener('input', render);
      document.getElementById(id).addEventListener('change', render);
    });

    $('#clearFilters').addEventListener('click', () => {
      $('#q').value = '';
      $('#game').value = '';
      $('#from').value = '';
      $('#to').value = '';
      $('#radius').value = 50;
      $('#sort').value = 'distance';
      render();
    });

    $('#useLoc').addEventListener('click', () => {
      if (!('geolocation' in navigator)) {
        alert('Geolocaliza√ß√£o n√£o suportada neste navegador. Use a op√ß√£o manual.');
        return;
      }
      navigator.geolocation.getCurrentPosition((pos) => {
        userLoc = { lat: pos.coords.latitude, lon: pos.coords.longitude };
        render();
      }, (err) => {
        console.warn('Geo erro', err);
        alert('N√£o foi poss√≠vel obter sua localiza√ß√£o. Verifique permiss√µes do navegador.');
      }, { enableHighAccuracy: true, timeout: 10000, maximumAge: 60000 });
    });

    $('#applyManual').addEventListener('click', () => {
      const lat = parseFloat($('#lat').value);
      const lon = parseFloat($('#lon').value);
      if (Number.isFinite(lat) && Number.isFinite(lon)) {
        userLoc = { lat, lon };
        render();
      } else {
        alert('Informe uma latitude e longitude v√°lidas.');
      }
    });

    // Inicializa
    render();
  </script>
</body>
</html>
